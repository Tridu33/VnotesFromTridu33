# 51OnRisc-v




在51内核单片机运行的程序在risc-v内核单片机能不能运行？ - 高飞车的回答 - 知乎
https://www.zhihu.com/question/538669420/answer/2540219808









大致需要做这些事情：

用结构体描述8051的寄存器、SFR、RAM、ROM。
内核仿真：从ROM取机器码，解码，完成操作。
比如，读到一字节0x28，知道对应的指令是MOV A, R0，就把R0的值复制到ACC中。
再比如，读到一字节0x91，知道是AJMP指令，到下一指令周期（12个时钟周期后）再读一字节，拼接目标地址，完成跳转。假设读到0x88，就知道跳转目标是0x488，把PC赋值为0x0488。
中断仿真：检查中断标志，如有，把PC压栈，把中断向量地址赋给PC，清除中断标志。
外设仿真：如果用到外设（IO、定时器、串口、外中断等），要在每一个时钟周期根据外设SFR的配置，操作虚拟外设（比如递增定时器、设置中断标志），并在虚拟外设和实际IO之间传递电平信号。











惠普在70年代开发的一系列计算器技术资料相对完备，于是选择其中一款HP-45作为复刻对象。它是逆波兰式科学计算器，有基本初等函数、度分秒、直角/极坐标、统计等功能。限于当时的半导体技术，CPU主频仅有约784kHz，每秒执行约3500条机器码。

https://github.com/reiyawea/HP-45-emulator

HP-45的CPU构架、总线、指令集、ROM机器码（固件）都详细列在它的专利文件中，很容易获取到。我据此用C语言写成HP CPU的虚拟机，在上面直接运行HP-45机器码。






