# 1. 常用循环摘要的自动生成方法及其应用


http://jos.org.cn/html/2017/5/5211.htm








对循环语句的分析验证工作主要集中在自动生成循环不变式, 然后基于循环不变式来证明循环的正确性、安全性等.Hoare逻辑指出, 要得到合适的循环不变式通常需要人工参与.现在的工作只能对特定的情形提出一些启发式的方法, 没有通用的方法对所有的情况都能得到正确的结果[4].

目前, 生成循环不变式的方法主要分为基于迭代不动点 (fixed point) 的方法、基于参数化模板 (template) 的方法以及基于动态执行 (dynamic execution) 的方法.

基于迭代不动点的方法计算程序的状态转换, 当程序状态不再变化时, 认为到达不动点, 计算结束.这种方法通常需要使用加宽算子 (widening)、提高抽象粒度等方法来保证和加速收敛的过程, 会带来精度损失问题.

基于参数化模板的方法主要针对线性数值计算程序, 计算时首先指定目标循环不变式的模板形式, 其中, 变量的系数未知; 然后求解模板中的系数, 从而得到循环不变式.这种方法需要用户指定模板形式, 不仅给用户带来负担, 而且用户可以提供的模板有限, 因此, 这种方法的适应性不强.Daikon[5]

通过动态执行程序的方法来生成循环不变式.这种方法依赖于测试用例, 无法保证生成的循环不变式一定是正确的.








关于循环语句的另一个研究热点是自动生成循环语句的摘要, 然后将循环语句的摘要应用于停机检验、软件的动态分析、缺陷检测等领域中.

通常情况下, 不同的研究领域对循环摘要的定义也有所不同:文献[6]将循环摘要定义为转换不变式, 即循环语句的前置条件和后置条件之间的关系, 并将转换不变式应用于程序的终止性分析中; 文献[7]将循环摘要定义为一组符号化的执行路径, 用于辅助动态测试的生成; 文献[8]将循环摘要定义为符号化的谓词转换, 用于发现程序中的缓冲区溢出问题.根据循环摘要定义的不同, 生成循环摘要的方法也各不相同, 主要分为3种方法, 分别是动态执行循环生成循环摘要、基于抽象解释[9]生成循环摘要以及计算符号化的抽象转换生成循环摘要.采用动态执行的方法依赖于测试用例, 生成的循环摘要可能有偏差.基于抽象解释的方法需要逼近不动点, 这会引起精度问题.




本文提出的自动生成包括循环语句在内的程序语句的摘要的方法使用Java语言实现, 已经集成到程序验证工具Accumulator中, 能够在多个平台上直接运行.Accumulator中集成了一些自动化和半自动化的技术, 比如别名分析、数据流分析、计算前置条件等.

我们应用本文提出的方法为一系列循环程序自动生成了摘要, 同时, 根据生成的摘要自动生成了循环语句的规约, 包括前置条件、后置条件以及循环不变式, 提高了程序验证的自动化程度和效率, 为验证人员减轻了负担.




不同的工作生成前置条件的目标有所不同.文献[19, 20]生成前置条件来验证程序的中执行.文献[21, 22]旨在为循环语句中安全性相关的断言生成前置条件.文献[23]为了编译器的优化而计算循环语句的最弱前置条件.文献[24-28]为了验证程序的正确性而生成前置条件, 这和本文的目标是一致的.文献[24, 25]借助于循环不变式来简化循环.文献[27]通过识别while循环中的不变式关系 (inva riant relation)[29]来计算后置条件关于循环语句的前置条件.文献[28]通过删除控制流图中的所有回边来消除循环并添加循环不变式来控制循环体.尽管很多工作致力于研究循环不变式, 但是自动生成循环不变式本身依旧是一个非常具有挑战性的工作.不同于所有这些方法, 本文不需要借助于循环不变式就可以生成循环语句的前置条件.文献[26]首先通过对循环迭代的次数进行限制来将循环转换为非循环程序, 这种方式会带来精度损失, 而本文的方法是精确的.文献[30]根据循环语句的后置条件和循环体中的中间断言来生成循环语句的前置条件, 生成的依据是给定的一些规则, 而本文依据的是自动生成的循环摘要, 减少了人工参与的成本.

5.2.2 循环不变式


常用的生成循环不变式的方法包括基于抽象解释的方法、基于谓词抽象的方法、基于约束求解的方法以及基于断言的方法.

基于抽象解释技术, 文献[31-35]可以有效地生成线性不变式和多项式不变式.不同于基于抽象解释的方法, 本文不仅可以生成线性不变式和多项式不变式, 还可以为操作非循环单链表等自定义的数据结构生成量化的循环不变式.文献[36]根据给定的谓词构造布尔组合形式的循环不变式, 该方法已经实现并作为文献[37]的一部分.

基于约束求解, 文献[38-41]首先生成指定目标不变式的模板形式, 其中变量的系数未知, 然后使用不同的技术求解模板中的参数从而得到不变式.文献[42]依赖于循环语句的中间断言来生成循环不变式.文献[4, 43]根据规则将后置条件进行弱化生成循环不变式.不同于

基于谓词抽象、约束求解和断言的方法, 本文的方法不需要用户提供任何信息, 不会给验证人员任何负担, 同时降低了出错概率.文献[44]通过记录每次循环条件变化时程序变量的值获取程序变量之间的函数依赖关系, 生成形如y=f(x1, x2, …, xn) 的循环不变式, 
本文生成的循环不变式种类更多.

文献[45, 46]介绍了形状图和形状图逻辑的概念, 并提出了基于形状图逻辑来自动生成循环不变形状图的推断方法.该方法要求源程序增加形状声明来处理指针程序.

文献[47]提出了一种基于分离逻辑推断链表程序的循环不变式的方法.它利用符号执行机制和一套重写规则, 迭代计算不动点.不同于文献[45-47], 本文提出的方法基于Scope逻辑.Scope逻辑是对Hoare逻辑的扩展, 可以有效地处理指针程序, 但不要求在源程序中增加任何内容.


















































































































