


## 1.1. 形式规约分离逻辑

分离逻辑是近年来程序验证领域的重大突破之一，它由Reynolds、O’Heam、Ishtiaq 和Yang等人在2000年前后提出[274-275’196’232]。并发分离逻辑是Brooked278]和0’ Heam_  对分离逻辑的扩展，支持对共享内存的并发程序的验证。它的基本思想是要求并发任务 对共享资源（包括内存）的访问在互斥的临界区中进行。而在临界区之外，并发任务只 能访问自己的私有资源。要实现这一点，必须有效保证共享资源和私有资源的分离，以 及不同任务各自的私有资源的分离。而分离逻辑中的分离合取恰恰能够用来方便地描述 这一点。并发分离逻辑主要针对良好同步（properlysynchronized) 的程序的验证，之后 有大量工作对并发分离逻辑进行扩充，以支持细粒度并发或者无锁并发程序的验证。在 Brookes和0’ Heam的综述文章中[28°]，对基于并发分离逻辑开展的工作有完整的介绍，在此不再赘述。

并发分离逻辑及其扩展大多针对串行一致性内存模型上的并发程序开展验证。然而， 由于处理器体系结构中以及编译器中引人的种种优化，导致并发程序的行为并不满足串 行一致性。这些行为统称为弱内存模型。

近年来，Viktra•等人对并发分离逻辑进行扩展， 提出一系列在C11内存模型上的程序逻辑[281 2871，证明C11内存模型（子集）上程序的 正确性。





除了需要对计算机系统进行形式建模之外，我们还需要对系统应满足的性质进行准 确的规约。一般使用逻辑公式对系统的性质进行规约。经典的规约语言包括针对串行程 序的一阶逻辑及其扩展分离逻辑、针对并发程序的时序逻辑等。

一阶逻辑在命题逻辑（布尔逻辑）的基础上加人关系（函数）符号和一阶量词。 Floyd-Hoare逻辑将一阶逻辑用于对串行程序的行为进行规约和推理[231]。Floyd-Hoare逻 辑未提供对内存布局的描述手段，不能刻画“指针”等程序结构。为此，分离逻辑 (separationlogic) 在2000年左右被提出[232]。该逻辑在一阶逻辑的基础上引人了分离算 子，即分离合取4和分离蕴含4。分离算子可以非常方便地表示程序不同组成部分所操作内存区域的独立性，并在推理规贝lj中将Floyd-Hoare逻辑的不变式（invariance) 规贝lj替换 为框架（frame) 规则，从而实现对程序行为的局部推理，而分离逻辑中的归纳谓词则可 以非常直观地描述链表和树等动态数据结构。分离逻辑提出后，有一大批在其之上的后 续工作，大大推动了程序验证的发展。

Floyd-Hoare逻辑和分离逻辑比较适合对串行程序终止时的输人和输出应该满足的关 系进行规约，而并发程序一般不终止，对其进行规约需要不同的规约语言。时序逻辑是 目前使用的主流的并发程序的规约语言。按照对时间的不同解释，时序逻辑大体可以分 为线性时序逻辑和分叉时序逻辑两大类，前者如LTL( Linear-time Temporal Logic) 等，后 者如 CTL( Computation Tree Logic)、CTL * 等。

针对串行程序的形式规约语言近5 年的进展集中在分离逻辑方面。研究人员近5 年 对于带归纳谓词的分离逻辑的各种片段的可判定性、复杂性、判定算法以及启发式算法 进行了广泛的探讨。分离逻辑不仅可以描述形状性质，比如链表，也可以描述数据约束， 比如有序性。

研究人员首先对不含数据约束的带归纳谓词的分离逻辑的判定算法进行了探讨。 Cook等人证明了含有单链表片段归纳谓词的分离逻辑子集的可满足性问题和蕴含问题是 多项式时间可判定的[233]。Antonopoulos等人证明了带归纳谓词的分离逻辑的蕴含问题一 般是不可判定的[234]。另一方面，Iosif等人将分离逻辑嵌人树深度受限的图上的一元二阶 逻辑中，证明了带某一类归纳谓词的分离逻辑的蕴含问题是可判定的[235]。而且， Brotherston等人对于带比较一般的归纳谓词的分离逻辑的可满足性问题进行了深人的研 究，他们证明了该逻辑的可满足性问题是EXPTIME-完全的[236]。Iosif等人将带归纳谓词 的分离逻辑的蕴含问题归约成树自动机的语言包含问题，开发了分离逻辑蕴含问题求解 器 SLIDE[237]。

研究人员在含有可以描述数据约束的归纳谓词的分离逻辑方面也进行了广泛的探讨。 Chm等人和Q m等人考虑了带归纳谓词和一般数据约束（比如算术约束、集合约束、多 重集约束等）的分离逻辑，提出了求解蕴含问题的启发式算法[238 239]。他们还对带线性 算术数据约束的归纳谓词的分离逻辑的可满足性问题进行了研究，提出了启发式算法， 并对这些算法在哪些子类上是完备的进行了探讨[24° 2411。Kskac等人将分离逻辑公式嵌 人经典一阶逻辑的含有集合变量和可达谓词的某种扩展，使得可以对序关系和集合数据 约束进行描述推理[242 2431。Enea等人提出了可组合归纳谓词的概念，简化了对含有归纳 谓词和复杂数据约束的分离逻辑公式的求解[244]，但他们提出的算法是不完备的。

针对并发程序的规约逻辑LTL由Pnueli提出[245]，其在命题逻辑的基础上引人了 Next(X) 和Until(U) 两个时序算子。LTL由于具有简洁、直观的特点，同时有具有相对 较强的表达能力，因而在验证领域被广泛使用。LTL能够表达全部star-free的《 -正规性 质，其模型检测问题及可满足性判定问题都是PSPACE-完全的[246]。C T L由Clarke、 Emerson等人提出[247]。同LTL相比，CTL中引人了全称路径量词A和存在路径量词 E(二者互为对偶关系）。CTL的模型检测问题可在多项式时间内完成[248] ; CTL的可满足 性问题是EXPTIM-完全的[25°]。CTI/ 是LTL与CTL的共同超集。CTI/ 公式的模型检测问题也是PSPACE-完全的[248’251]，其可满足性问题是2EXPTIME-完全的[249]。

时序逻辑方面近5 年的进展集中在经典时序逻辑LTL、CTL和CTL4的各种扩展上， 包括博弈扩展、概率扩展、实时扩展、量子扩展等。

首先，研究人员提出了用于描述多主体系统性质的时序逻辑的博弈扩展，比如ATL、 ATI/[252]、StrategyL〇gic[253]等。ATL的模型检测问题是PTIME-完全的[252];其可满足性 问题是EXPTIME-完全的[254]。ATI/ 是ATL的扩展，ATI/ 的模型检测问题以及可满足性 问题的复杂度均是2EXPTIME-完全的[252,255]。StrategyLogic具有非常强的表达能力，即 使是其一次交错片段（否定范式公式中量词V和3 最多只能嵌套交错一次的公式构成的 片段），也能够编码全部的ATI/ 公式。该逻辑可以描述纳什均衡、安全均衡等重要的性 质。StrategyLogic的模型检测问题和可满足性问题是非初等可判定的[256]。但是，对于其 一些简单的片段，如一次交错片段，其模型检测问题是2EXPTIME-完全的[256]。

时序逻辑的概率扩展主要包括PCTL、PCTL4等，它们的语义定义在离散马尔可夫链 或者离散马尔可夫决策过程（MDP) 上。对于离散马尔可夫链模型，PCTL的模型检测问 题可在多项式时间内完成[113]，而LTL和PCTI/ 的模型检测问题仍是PSPACE-完全 的[257 259]。对于离散马尔可夫决策过程，PCTL的模型检测问题也可以在多项式时间内完 成，但W L的模型检测问题却是2EXPTIME-完全的（即使是定性验证）[78]。PCTL的可 满足性问题比较复杂，目前还没有完全得到解决。

时序逻辑的实时扩展，典型包括M T L和TCTL: 前者定义在线性结构上，后者定义 在分支结构上。MTL可以看作是LTL的扩展，它取消了 X算子，并在U算子上附加一个 区间下标/—— 其Unitl公 式 形 如 ，它显式地指明了/2成立的时刻应当位于区间/ 内[26°]。TCTL在CTL的基础上引人了时钟变量，并取消了 X时序算子[26°]。这两类逻辑 的语义均定义在实时系统上（如时间自动机）。M T L的可满足性问题和针对时间自动机 的模型检测问题在连续时间上是不可判定的[2611，在离散时间上是EXPSPACE-完 全的[262]。

时序逻辑的量子扩展主要包括QCTL、QCTI/ 等，其语义主要定义在量子马尔可夫链 上。QCTL在量子马尔可夫链上的验证可在多项式时间内完成[272];同样，该逻辑的可满 足性的判定问题目前仍然没有解决。关于量子马尔可夫链上的LTL模型检测问题，国内 外学者仍在进行研究。

另外，研究人员针对计算机安全的背景，提出了时序逻辑的“超性质”的扩展[263]， 主要包括HyperLTL、HyperCTI/ 等。HyperLTL的模型检测算法在最坏情况下是非初等可 判定的，同时这两种逻辑的可满足性问题也是非初等可判定的，但对于其某些特定片段 却存在较为高效的算法[263]。Finkbeinei•等人给出了关于HyperLTL和HyperCTI/ 的模型检 测的实现[264]





甫京大学赵建华、李宣东教提的研究团队，提出T分离逻辑的一种变种，称之为 ScopeL〇gic[2S5]。该种逻辑中引人了 3 类:基本算宁，分别对虛于基本内存访问、结构字段 访问、数组访问操作。这种扩展可以较好地与命令式语言之间产生对应。

科普 - 程序验证（6）- 分离逻辑 - FRONTIERS的文章 - 知乎
https://zhuanlan.zhihu.com/p/314605288

[^形式化方法CCF]: 形式化方法的研究进展与趋势 https://dl.ccf.org.cn/books/detail.html?_ack=1&id=4138192862726144
[^人工智能形式化CCF]: 人工智能系统的形式化发展与趋势 https://dl.ccf.org.cn/books/detail.html?_ack=4&id=5161520744974336

------------------------------------------------------------------------------------------------------------------



Facebook将基于分离逻辑的验证工具Infei•广泛用于其Android应用的开发过 程中



https://en.wikipedia.org/wiki/Separation_logic

分离逻辑[1]是Hoare逻辑的扩展，这是一种有关程序推理的方法。它由John C. Reynolds，Peter O'Hearn，Samin Ishtiaq和Hongseok Yang [1] [2] [3] [4]开发，并借鉴了Rod Burstall的早期工作。[5]分离逻辑的断言语言是聚类含义（BI）逻辑的特例。[6] O'Hearn撰写的CACM评论文章列出了该主题在2019年初的进展。[7]



分离逻辑有助于进行以下推理：

    操纵指针数据结构的程序-包括在存在指针的情况下隐藏的信息；
    “所有权转移”（避免使用语义框架公理）
    并发模块之间的虚拟分离（模块化推理）

分离逻辑支持由Peter O'Hearn和其他人描述为局部推理的研究发展领域，其中程序组件的规范和证明仅提及该组件使用的内存部分，而不涉及系统的整个全局状态。应用程序包括自动程序验证（一种算法检查另一种算法的有效性）和软件的自动并行化

https://dl.acm.org/doi/10.1145/2984450.2984457 综述


并发分离逻辑（CSL）最初在《理论计算机科学》上发表的有关约翰·雷诺兹（John Reynolds）诞辰70周年的纪念活动（2007）的论文中得到了改进。初步版本已作为邀请论文出现在CONCUR'04会议录中。导致这些论文的基础工作始于2002年。自那时以来，CSL在理论和实践研究方面都取得了重大进展。在这篇回顾性论文中，我们描述了支持CSL的主要思想，通过总结2002-2003年发明逻辑时并发验证和编程语言语义学的流行趋势，将这些思想置于历史背景中。最后，我们概述了截至2016年的最新情况。在此过程中，我们描述了这段时期的一些主要发展，并且我们尝试将已完成的工作大致分为几类。尽管我们不打算进行详尽的调查，但我们希望提供一些有关该领域已取得的成就，尚待完成的工作以及未来工作方向的一般观点。



# 2. 用分离逻辑建模

《形式化方法的研究进展与趋势》


除了需要对计算机系统进行形式建模之外，我们还需要对系统应满足的性质进行准 确的规约。一般使用逻辑公式对系统的性质进行规约。经典的规约语言包括针对串行程 序的一阶逻辑及其扩展分离逻辑、针对并发程序的时序逻辑等。一阶逻辑在命题逻辑（布尔逻辑）的基础上加人关系（函数）符号和一阶量词。 Floyd-Hire逻辑将一阶逻辑用于对串行程序的行为进行规约和推理[2)]。Floyd-Hire逻 辑未提供对内存布局的描述手段，不能刻画“**指针**”等程序结构。为此，分离逻辑 (separationlogic) 在2000年左右被提出[232]。该逻辑在一阶逻辑的基础上引人了分离算 子，即分离合取*和分离蕴含"。分离算子可以非常方便地表示程序不同组成部分所操作


内存区域的独立性，并在推理规则中将Floyd-Hoare逻辑的不变式（invariance) 规则替换 为框架（frame) 规则，从而实现对程序行为的局部推理，而分离逻辑中的归纳谓词则可 以非常直观地描述**链表和树等动态数据结构**。分离逻辑提出后，有一大批在其之上的后 续工作，大大推动了程序验证的发展



**Floyd-Hoae逻辑和分离逻辑比较适合对串行程序**终止时的输人和输出应该满足的关 系进行规约，

---------------------------------------------------------------------------------------------------


等价正则文法，QNP串行确定性dfa==FOND并行非确定性nfa

----------------------------------------------------------------------------------------------------------
而**并发程序**一般不终止，对其进行规约需要不同的规约语言。**时序逻辑**是 目前使用的主流的并发程序的规约语言。按照对时间的不同解释，时序逻辑大体可以分 为**线性时序逻辑和分叉时序逻辑**两大类，前者如LTL( Linear-timeTemporalLogic) 等，后 者如 CTL% ComputationTreeLogic) # CTL * 等

针对串行程序的形式规约语言近5 年的进展集中在分离逻辑方面。研究人员近5 年 对于带归纳谓词的分离逻辑的各种片段的可判定性、复杂性、判定算法以及启发式算法 进行了广泛的探讨。**分离逻辑不仅可以描述形状性质，比如链表，也可以描述数据约束， 比如有序性**


研究人员首先对不含数据约束的带归纳谓词的分离逻辑的判定算法进行了探讨。 C o k等人证明了含有单链表片段归纳谓词的分离逻辑子集的可满足性问题和蕴含问题是 多项式时间可判定的[233]。Antonopoulo:等人证明了带归纳谓词的分离逻辑的蕴含问题一 般是不可判定的[234]。另一方面，G: 等人将分离逻辑嵌人树深度受限的图上的一元二阶 逻辑中，证明了带某一类归纳谓词的分离逻辑的蕴含问题是可判定的[235]。而且， Brotheston等人对于带比较一般的归纳谓词的分离逻辑的可满足性问题进行了深人的研 究，他们证明了该逻辑的可满足性问题是EXPTIME-完全的[23% 。G: 等人将带归纳谓词 的分离逻辑的蕴含问题归约成树自动机的语言包含问题，开发了分离逻辑蕴含问题求解 器 SLIDE"237










**分离逻辑**是近年来程序验证领域的重大突破之一，它由Reynold:  0’ Hearn、Ghtiaq 和Yang等人在2000年前后提出[274—275,196,232]。并发分离逻辑是Brooke:278#和QHeam[279] 对分离逻辑的扩展，支持对共享内存的并发程序的验证。它的基本思想是要求并发任务 对共享资源（包括内存）的访问在互斥的临界区中进行。而在临界区之外，并发任务只 能访问自己的私有资源。

要实现这一点，必须有效保证共享资源和私有资源的分离，以 及不同任务各自的私有资源的分离。而分离逻辑中的分离合取恰恰能够用来方便地描述 这一点。并发分离逻辑主要针对良好同步（pmperlysynchronized) 的程序的验证，之后 有大量工作对并发分离逻辑进行扩充，以支持细粒度并发或者无锁并发程序的验证。在 Bmokes和0’ H e m的综述文章中[28°]，对基于并发分离逻辑开展的工作有完整的介绍




并发分离逻辑及其扩展大多针对串行一致性内存模型上的并发程序开展验证。然而， 由于处理器体系结构中以及编译器中引人的种种优化，导致并发程序的行为并不满足串 行一致性。这些行为统称为弱内存模型。近年来，V;ti等人对并发分离逻辑进行扩展， 提出一系列在C11内存模型上的程序逻辑"28!28& ，证明C11内存模型（子集）上程序的 正确性。关系型程序逻辑可以验证两个程序之间的关系，或者一个程序在两种输人下的行为 之间的关系。前者可用于程序精化的验证，而后者则可用于安全性质，特别是信息流控 制（informationflowcontrol) 机制的验证。Benton"288#和Yang_ # 较早提出关系型程序逻 辑。Beringer和Hofmann提出将关系型程序逻辑应用于信息流控制"2(* 。Barthe等在关系 型程序逻辑方面开展了大量研究，主要将其应用于安全性质验证"2(!2(2#。Turn等"2(3]和 Liang等[2(4]提出了关系型程序逻辑来开展并发程序的精化验证。作为对关系型程序逻辑 的扩展，Sousa和Dillig提出笛卡儿霍尔逻辑，用于验证（-safety，即程序（次不同执行之 间的关系[2(5]。近年来，有大量的基于演绎推理验证技术对实际系统在代码级的验证。其中比较有 代表性的包括操作系统内核验证和编译器验证。操作系统内核验证相关的工作包括澳大 利亚NICTA对 ：L4 的验证[2(6]、耶鲁大学团队对CertiKOS的验证[2(7]、中科大团队对 #C/OS-II的验证等[4。]。编译器验证工作中最著名的是INRIA对CompCert的验证[2(8—2((] 以及后续工作[3°°3°2]。此外，还包括对分布式系统的验证[3°33°4]、安全系统的验 证[观―_ 、文件系统的验证3。]等





中科院软件所的吴志林等人对带归纳谓词的分   的判定算法进行了深人的研究。对Cook等人的单链表片段上的多项式  的结果的扩展，证明了链表片段的归纳谓词的分   的    性问题是NP-完全的，而且   将C o k等人的多项式  的结   展   结构上[2%]。   对于   线性算   束   组合归纳谓词的分离逻辑子集的判定算法进行了深人的探讨[2%&2%8




国内从事形式规约的研究人员不多，目前流行的形式规约语言，比如分离逻辑、时 序逻辑等，基本是国外的研究人员提出来的。国内研究人员在形式规约语言的研究工作 集中在对已有规约语言的理论性质（比如表达能力和判定算法& 的探讨上。国内研究人 员最近5 年在分离逻辑和时序逻辑的各种扩展上开展了较深人的工作，总体来讲较以前 有所进步



























